2025-11-06 07:55:10,893 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
2025-11-06 07:56:10,958 - tool_logger - INFO - get_workflow called in PID=50020 TID=123145625337856 agent=1
2025-11-06 07:56:10,960 - tool_logger - INFO - SQL Tokens: Input= 2495, Output= 84, TOT= 2579
2025-11-06 07:56:10,961 - tool_logger - INFO - SQL Tokens: Input= 2519, Output= 53, TOT= 2572
2025-11-06 07:56:10,961 - tool_logger - INFO - SQL Tokens: Input= 2792, Output= 76, TOT= 2868
2025-11-06 07:56:10,962 - tool_logger - INFO - SQL Tokens: Input= 2853, Output= 18, TOT= 2871
2025-11-06 07:56:10,962 - tool_logger - INFO - SQL TOTAL Tokens: 10890
2025-11-06 07:56:10,962 - tool_logger - INFO - Writing 31 local_entries for SQL_agent_history (PID=50020 TID=123145625337856)
2025-11-06 07:56:10,962 - tool_logger - INFO - buffer_workflow called in PID=50020 TID=123145625337856 key=SQL_agent_history entries=31
2025-11-06 07:56:10,962 - tool_logger - INFO - Buffered Queue Workflow SQL_agent_history: ['_**Request**_:  \nIs Daniele Celsa available on Monday at 10?', '-> _**SQL Agent msg**_:  \nOkay, I will check if Daniele Celsa is available on Monday at 10:00.\n\n1. Parse:\n   - person: Daniele Celsa\n   - day_raw: Monday -> day: Monday\n   - time_raw: 10 -> time: 10:00\n\n2. sql_db_list_tables:', '-> _**Call Tool**_:  \nsql_db_list_tables', '-> _**With ARGS**_:  \n{}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2495, Output= 84, TOT= 2579', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_list_tables', '-> _**Tool msg**_:  \navailability, staff, staff_name_mapping', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nOkay, the tables are `availability`, `staff`, and `staff_name_mapping`. I need to check the schema of the `availability` table to see the column names and how the day is stored.', '-> _**Call Tool**_:  \nsql_db_schema', "-> _**With ARGS**_:  \n{'table_names': 'availability'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 2519, Output= 53, TOT= 2572', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_schema', '-> _**Tool msg**_:  \n\nCREATE TABLE availability (\n\tday VARCHAR, \n\ttime VARCHAR, \n\t"Marco_Rossi" INTEGER, \n\t"Luca_Scanzi" INTEGER, \n\t"Anna_Garau" INTEGER, \n\t"Marco_Verdi" INTEGER, \n\t"Marco_Bianchi" INTEGER, \n\t"Alice_Rea" INTEGER, \n\t"Corrado_Mercurio" INTEGER, \n\t"Daniele_Celsa" INTEGER, \n\t"Roberto_Coppolino" INTEGER\n)\n\n/*\n3 rows from availability table:\nday\ttime\tMarco_Rossi\tLuca_Scanzi\tAnna_Garau\tMarco_Verdi\tMarco_Bianchi\tAlice_Rea\tCorrado_Mercurio\tDaniele_Celsa\tRoberto_Coppolino\nMonday\t09:00\t1\t1\t1\t1\t1\t0\t0\t0\t1\nMonday\t10:00\t0\t1\t0\t0\t0\t0\t1\t1\t1\nMonday\t11:00\t1\t1\t1\t1\t1\t1\t0\t0\t0\n*/', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nOkay, I have the table schema.\nThe person is "Daniele Celsa", the day is "Monday", and the time is "10:00".', '-> _**Call Tool**_:  \nsql_db_query', '-> _**With ARGS**_:  \n{\'query\': \'SELECT day, time, "Daniele_Celsa" AS available FROM availability WHERE LOWER(day) = LOWER(\\\'Monday\\\') AND time = \\\'10:00\\\';\'}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2792, Output= 76, TOT= 2868', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_query', "-> _**Tool msg**_:  \n[('Monday', '10:00', 1)]", '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nYes, Daniele Celsa is available on Monday at 10:00.', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2853, Output= 18, TOT= 2871', '####---------------------------------------####']
2025-11-06 07:56:10,963 - tool_logger - INFO - buffer_usage called in PID=50020 TID=123145625337856 key=SQL_last_tokens total_token=10890
2025-11-06 07:56:10,963 - tool_logger - INFO - Buffered Queue Usage SQL_last_tokens: 10890
2025-11-06 07:56:10,963 - tool_logger - INFO - SQL_AGENT RESULT: {'messages': [HumanMessage(content='Is Daniele Celsa available on Monday at 10?', additional_kwargs={}, response_metadata={}, id='99046879-8520-4540-880e-842def05f476'), AIMessage(content='Okay, I will check if Daniele Celsa is available on Monday at 10:00.\n\n1. Parse:\n   - person: Daniele Celsa\n   - day_raw: Monday -> day: Monday\n   - time_raw: 10 -> time: 10:00\n\n2. sql_db_list_tables:', additional_kwargs={'function_call': {'name': 'sql_db_list_tables', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--f319ee5c-ae8f-4bc3-8cda-537ac594be86-0', tool_calls=[{'name': 'sql_db_list_tables', 'args': {}, 'id': 'eed174be-7656-4487-8dab-d03b78bafb6d', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2495, 'output_tokens': 84, 'total_tokens': 2579, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='availability, staff, staff_name_mapping', name='sql_db_list_tables', id='76e96db2-4c8b-4deb-9e1b-d332a5aa6e52', tool_call_id='eed174be-7656-4487-8dab-d03b78bafb6d'), AIMessage(content='Okay, the tables are `availability`, `staff`, and `staff_name_mapping`. I need to check the schema of the `availability` table to see the column names and how the day is stored.', additional_kwargs={'function_call': {'name': 'sql_db_schema', 'arguments': '{"table_names": "availability"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--4e8328b3-01d1-428f-a305-117376e514d4-0', tool_calls=[{'name': 'sql_db_schema', 'args': {'table_names': 'availability'}, 'id': 'c5f62b13-0fb6-4f93-af01-1a06f342fe4d', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2519, 'output_tokens': 53, 'total_tokens': 2572, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='\nCREATE TABLE availability (\n\tday VARCHAR, \n\ttime VARCHAR, \n\t"Marco_Rossi" INTEGER, \n\t"Luca_Scanzi" INTEGER, \n\t"Anna_Garau" INTEGER, \n\t"Marco_Verdi" INTEGER, \n\t"Marco_Bianchi" INTEGER, \n\t"Alice_Rea" INTEGER, \n\t"Corrado_Mercurio" INTEGER, \n\t"Daniele_Celsa" INTEGER, \n\t"Roberto_Coppolino" INTEGER\n)\n\n/*\n3 rows from availability table:\nday\ttime\tMarco_Rossi\tLuca_Scanzi\tAnna_Garau\tMarco_Verdi\tMarco_Bianchi\tAlice_Rea\tCorrado_Mercurio\tDaniele_Celsa\tRoberto_Coppolino\nMonday\t09:00\t1\t1\t1\t1\t1\t0\t0\t0\t1\nMonday\t10:00\t0\t1\t0\t0\t0\t0\t1\t1\t1\nMonday\t11:00\t1\t1\t1\t1\t1\t1\t0\t0\t0\n*/', name='sql_db_schema', id='7000a1a5-a1c8-4ef1-816d-8f538234cec1', tool_call_id='c5f62b13-0fb6-4f93-af01-1a06f342fe4d'), AIMessage(content='Okay, I have the table schema.\nThe person is "Daniele Celsa", the day is "Monday", and the time is "10:00".', additional_kwargs={'function_call': {'name': 'sql_db_query', 'arguments': '{"query": "SELECT day, time, \\"Daniele_Celsa\\" AS available FROM availability WHERE LOWER(day) = LOWER(\'Monday\') AND time = \'10:00\';"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--5e0b15ca-3f59-432d-a599-21dda0ed347b-0', tool_calls=[{'name': 'sql_db_query', 'args': {'query': 'SELECT day, time, "Daniele_Celsa" AS available FROM availability WHERE LOWER(day) = LOWER(\'Monday\') AND time = \'10:00\';'}, 'id': 'e02c9c89-da6a-4727-b477-760d24d5e0c0', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2792, 'output_tokens': 76, 'total_tokens': 2868, 'input_token_details': {'cache_read': 0}}), ToolMessage(content="[('Monday', '10:00', 1)]", name='sql_db_query', id='3f0cb01f-629f-41ba-89d8-e426a8638d7a', tool_call_id='e02c9c89-da6a-4727-b477-760d24d5e0c0'), AIMessage(content='Yes, Daniele Celsa is available on Monday at 10:00.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--1258b5d2-18e7-4f33-a0ea-36d89f320d04-0', usage_metadata={'input_tokens': 2853, 'output_tokens': 18, 'total_tokens': 2871, 'input_token_details': {'cache_read': 0}})]}
2025-11-06 07:56:10,964 - tool_logger - INFO - SQL_AGENT CALBACKS: {'gemini-2.0-flash': {'total_tokens': 10890, 'output_tokens': 231, 'input_token_details': {'cache_read': 0}, 'input_tokens': 10659}}
2025-11-06 07:56:11,676 - tool_logger - INFO - get_workflow called in PID=50020 TID=123145555496960 agent=0
2025-11-06 07:56:11,677 - tool_logger - INFO - Supervisor Tokens: Input= 1262, Output= 18, TOT= 1280
2025-11-06 07:56:11,678 - tool_logger - INFO - Supervisor Tokens: Input= 1303, Output= 16, TOT= 1319
2025-11-06 07:56:11,678 - tool_logger - INFO - Supervisor TOTAL Tokens: 2599
2025-11-06 07:56:11,678 - tool_logger - INFO - Writing 13 local_entries for Supervisor_agent_history (PID=50020 TID=123145555496960)
2025-11-06 07:56:11,679 - tool_logger - INFO - buffer_workflow called in PID=50020 TID=123145555496960 key=Supervisor_agent_history entries=13
2025-11-06 07:56:11,679 - tool_logger - INFO - Buffered Queue Workflow Supervisor_agent_history: ['_**Request**_:  \nIs Daniele Celsa available on Monday at 10?', '-> _**Supervisor Agent msg**_:  \n', '-> _**Call Tool**_:  \ncheck_staff_info', "-> _**With ARGS**_:  \n{'request': 'Is Daniele Celsa available on Monday at 10?'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 1262, Output= 18, TOT= 1280', '####---------------------------------------####', '-> _**Tool Name**_:  \ncheck_staff_info', '-> _**Tool msg**_:  \nYes, Daniele Celsa is available on Monday at 10:00.', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**Supervisor Agent msg**_:  \nDaniele Celsa is available on Monday at 10:00.', '-> _**TOKEN USAGE** (agent)_:  \nInput= 1303, Output= 16, TOT= 1319', '####---------------------------------------####']
2025-11-06 07:56:11,679 - tool_logger - INFO - buffer_usage called in PID=50020 TID=123145555496960 key=Supervisor_last_tokens total_token=2599
2025-11-06 07:56:11,679 - tool_logger - INFO - Buffered Queue Usage Supervisor_last_tokens: 2599
2025-11-06 07:56:11,679 - tool_logger - INFO - Flushing workflow from fallback queue: key=SQL_agent_history entries=31
2025-11-06 07:56:11,679 - tool_logger - ERROR - Error flushing workflow fallback queue: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "/Users/domenicodanielecelsa/Desktop/AI_Projects/mail-calendar-assistant/app.py", line 295, in flush_workflow_queue
    key, entries = WORKFLOW_QUEUE.get_nowait()
ValueError: too many values to unpack (expected 2)
2025-11-06 07:56:11,680 - tool_logger - INFO - Flushing usage from fallback queue: usage=('Supervisor_agent_history', ['_**Request**_:  \nIs Daniele Celsa available on Monday at 10?', '-> _**Supervisor Agent msg**_:  \n', '-> _**Call Tool**_:  \ncheck_staff_info', "-> _**With ARGS**_:  \n{'request': 'Is Daniele Celsa available on Monday at 10?'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 1262, Output= 18, TOT= 1280', '####---------------------------------------####', '-> _**Tool Name**_:  \ncheck_staff_info', '-> _**Tool msg**_:  \nYes, Daniele Celsa is available on Monday at 10:00.', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**Supervisor Agent msg**_:  \nDaniele Celsa is available on Monday at 10:00.', '-> _**TOKEN USAGE** (agent)_:  \nInput= 1303, Output= 16, TOT= 1319', '####---------------------------------------####'])
2025-11-06 07:56:11,680 - tool_logger - ERROR - Error flushing usage fallback queue: 'tuple' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/domenicodanielecelsa/Desktop/AI_Projects/mail-calendar-assistant/app.py", line 354, in flush_usage_queue
    key = usage.get("key")
AttributeError: 'tuple' object has no attribute 'get'
2025-11-06 07:56:11,737 - tool_logger - INFO - SUPERVISOR ANSWER: {'messages': [AIMessage(content='Hello, I am your personal assistant: I can schedule your Meetings and send Emails!  \nHow can I help you today?', additional_kwargs={}, response_metadata={}, id='ce3f7e9c-e6d7-4a9f-8b2e-901e04bb5540'), HumanMessage(content='Is Daniele Celsa available on Monday at 10?', additional_kwargs={}, response_metadata={}, id='e926c53a-1f7c-4e6a-8878-dbd430b71c88'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'check_staff_info', 'arguments': '{"request": "Is Daniele Celsa available on Monday at 10?"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--c36543ac-295b-47dd-b4af-cc4bef769aba-0', tool_calls=[{'name': 'check_staff_info', 'args': {'request': 'Is Daniele Celsa available on Monday at 10?'}, 'id': 'add4172c-c160-4af2-857f-36e5c1e12a05', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1262, 'output_tokens': 18, 'total_tokens': 1280, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='Yes, Daniele Celsa is available on Monday at 10:00.', name='check_staff_info', id='726b01c9-45fc-4010-8985-2ed97b736e69', tool_call_id='add4172c-c160-4af2-857f-36e5c1e12a05'), AIMessage(content='Daniele Celsa is available on Monday at 10:00.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--07aced59-9d1b-4192-af23-175efafd4a25-0', usage_metadata={'input_tokens': 1303, 'output_tokens': 16, 'total_tokens': 1319, 'input_token_details': {'cache_read': 0}})]}
2025-11-06 07:56:11,738 - tool_logger - INFO - SUPERVISOR CALBACKS: {'gemini-2.0-flash': {'total_tokens': 2599, 'output_tokens': 34, 'input_token_details': {'cache_read': 0}, 'input_tokens': 2565}}
2025-11-06 08:24:00,841 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
2025-11-06 09:06:04,106 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
