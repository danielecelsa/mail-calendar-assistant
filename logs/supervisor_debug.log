2025-11-06 07:55:10,893 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
2025-11-06 07:56:10,958 - tool_logger - INFO - get_workflow called in PID=50020 TID=123145625337856 agent=1
2025-11-06 07:56:10,960 - tool_logger - INFO - SQL Tokens: Input= 2495, Output= 84, TOT= 2579
2025-11-06 07:56:10,961 - tool_logger - INFO - SQL Tokens: Input= 2519, Output= 53, TOT= 2572
2025-11-06 07:56:10,961 - tool_logger - INFO - SQL Tokens: Input= 2792, Output= 76, TOT= 2868
2025-11-06 07:56:10,962 - tool_logger - INFO - SQL Tokens: Input= 2853, Output= 18, TOT= 2871
2025-11-06 07:56:10,962 - tool_logger - INFO - SQL TOTAL Tokens: 10890
2025-11-06 07:56:10,962 - tool_logger - INFO - Writing 31 local_entries for SQL_agent_history (PID=50020 TID=123145625337856)
2025-11-06 07:56:10,962 - tool_logger - INFO - buffer_workflow called in PID=50020 TID=123145625337856 key=SQL_agent_history entries=31
2025-11-06 07:56:10,962 - tool_logger - INFO - Buffered Queue Workflow SQL_agent_history: ['_**Request**_:  \nIs Daniele Celsa available on Monday at 10?', '-> _**SQL Agent msg**_:  \nOkay, I will check if Daniele Celsa is available on Monday at 10:00.\n\n1. Parse:\n   - person: Daniele Celsa\n   - day_raw: Monday -> day: Monday\n   - time_raw: 10 -> time: 10:00\n\n2. sql_db_list_tables:', '-> _**Call Tool**_:  \nsql_db_list_tables', '-> _**With ARGS**_:  \n{}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2495, Output= 84, TOT= 2579', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_list_tables', '-> _**Tool msg**_:  \navailability, staff, staff_name_mapping', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nOkay, the tables are `availability`, `staff`, and `staff_name_mapping`. I need to check the schema of the `availability` table to see the column names and how the day is stored.', '-> _**Call Tool**_:  \nsql_db_schema', "-> _**With ARGS**_:  \n{'table_names': 'availability'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 2519, Output= 53, TOT= 2572', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_schema', '-> _**Tool msg**_:  \n\nCREATE TABLE availability (\n\tday VARCHAR, \n\ttime VARCHAR, \n\t"Marco_Rossi" INTEGER, \n\t"Luca_Scanzi" INTEGER, \n\t"Anna_Garau" INTEGER, \n\t"Marco_Verdi" INTEGER, \n\t"Marco_Bianchi" INTEGER, \n\t"Alice_Rea" INTEGER, \n\t"Corrado_Mercurio" INTEGER, \n\t"Daniele_Celsa" INTEGER, \n\t"Roberto_Coppolino" INTEGER\n)\n\n/*\n3 rows from availability table:\nday\ttime\tMarco_Rossi\tLuca_Scanzi\tAnna_Garau\tMarco_Verdi\tMarco_Bianchi\tAlice_Rea\tCorrado_Mercurio\tDaniele_Celsa\tRoberto_Coppolino\nMonday\t09:00\t1\t1\t1\t1\t1\t0\t0\t0\t1\nMonday\t10:00\t0\t1\t0\t0\t0\t0\t1\t1\t1\nMonday\t11:00\t1\t1\t1\t1\t1\t1\t0\t0\t0\n*/', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nOkay, I have the table schema.\nThe person is "Daniele Celsa", the day is "Monday", and the time is "10:00".', '-> _**Call Tool**_:  \nsql_db_query', '-> _**With ARGS**_:  \n{\'query\': \'SELECT day, time, "Daniele_Celsa" AS available FROM availability WHERE LOWER(day) = LOWER(\\\'Monday\\\') AND time = \\\'10:00\\\';\'}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2792, Output= 76, TOT= 2868', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_query', "-> _**Tool msg**_:  \n[('Monday', '10:00', 1)]", '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nYes, Daniele Celsa is available on Monday at 10:00.', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2853, Output= 18, TOT= 2871', '####---------------------------------------####']
2025-11-06 07:56:10,963 - tool_logger - INFO - buffer_usage called in PID=50020 TID=123145625337856 key=SQL_last_tokens total_token=10890
2025-11-06 07:56:10,963 - tool_logger - INFO - Buffered Queue Usage SQL_last_tokens: 10890
2025-11-06 07:56:10,963 - tool_logger - INFO - SQL_AGENT RESULT: {'messages': [HumanMessage(content='Is Daniele Celsa available on Monday at 10?', additional_kwargs={}, response_metadata={}, id='99046879-8520-4540-880e-842def05f476'), AIMessage(content='Okay, I will check if Daniele Celsa is available on Monday at 10:00.\n\n1. Parse:\n   - person: Daniele Celsa\n   - day_raw: Monday -> day: Monday\n   - time_raw: 10 -> time: 10:00\n\n2. sql_db_list_tables:', additional_kwargs={'function_call': {'name': 'sql_db_list_tables', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--f319ee5c-ae8f-4bc3-8cda-537ac594be86-0', tool_calls=[{'name': 'sql_db_list_tables', 'args': {}, 'id': 'eed174be-7656-4487-8dab-d03b78bafb6d', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2495, 'output_tokens': 84, 'total_tokens': 2579, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='availability, staff, staff_name_mapping', name='sql_db_list_tables', id='76e96db2-4c8b-4deb-9e1b-d332a5aa6e52', tool_call_id='eed174be-7656-4487-8dab-d03b78bafb6d'), AIMessage(content='Okay, the tables are `availability`, `staff`, and `staff_name_mapping`. I need to check the schema of the `availability` table to see the column names and how the day is stored.', additional_kwargs={'function_call': {'name': 'sql_db_schema', 'arguments': '{"table_names": "availability"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--4e8328b3-01d1-428f-a305-117376e514d4-0', tool_calls=[{'name': 'sql_db_schema', 'args': {'table_names': 'availability'}, 'id': 'c5f62b13-0fb6-4f93-af01-1a06f342fe4d', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2519, 'output_tokens': 53, 'total_tokens': 2572, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='\nCREATE TABLE availability (\n\tday VARCHAR, \n\ttime VARCHAR, \n\t"Marco_Rossi" INTEGER, \n\t"Luca_Scanzi" INTEGER, \n\t"Anna_Garau" INTEGER, \n\t"Marco_Verdi" INTEGER, \n\t"Marco_Bianchi" INTEGER, \n\t"Alice_Rea" INTEGER, \n\t"Corrado_Mercurio" INTEGER, \n\t"Daniele_Celsa" INTEGER, \n\t"Roberto_Coppolino" INTEGER\n)\n\n/*\n3 rows from availability table:\nday\ttime\tMarco_Rossi\tLuca_Scanzi\tAnna_Garau\tMarco_Verdi\tMarco_Bianchi\tAlice_Rea\tCorrado_Mercurio\tDaniele_Celsa\tRoberto_Coppolino\nMonday\t09:00\t1\t1\t1\t1\t1\t0\t0\t0\t1\nMonday\t10:00\t0\t1\t0\t0\t0\t0\t1\t1\t1\nMonday\t11:00\t1\t1\t1\t1\t1\t1\t0\t0\t0\n*/', name='sql_db_schema', id='7000a1a5-a1c8-4ef1-816d-8f538234cec1', tool_call_id='c5f62b13-0fb6-4f93-af01-1a06f342fe4d'), AIMessage(content='Okay, I have the table schema.\nThe person is "Daniele Celsa", the day is "Monday", and the time is "10:00".', additional_kwargs={'function_call': {'name': 'sql_db_query', 'arguments': '{"query": "SELECT day, time, \\"Daniele_Celsa\\" AS available FROM availability WHERE LOWER(day) = LOWER(\'Monday\') AND time = \'10:00\';"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--5e0b15ca-3f59-432d-a599-21dda0ed347b-0', tool_calls=[{'name': 'sql_db_query', 'args': {'query': 'SELECT day, time, "Daniele_Celsa" AS available FROM availability WHERE LOWER(day) = LOWER(\'Monday\') AND time = \'10:00\';'}, 'id': 'e02c9c89-da6a-4727-b477-760d24d5e0c0', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2792, 'output_tokens': 76, 'total_tokens': 2868, 'input_token_details': {'cache_read': 0}}), ToolMessage(content="[('Monday', '10:00', 1)]", name='sql_db_query', id='3f0cb01f-629f-41ba-89d8-e426a8638d7a', tool_call_id='e02c9c89-da6a-4727-b477-760d24d5e0c0'), AIMessage(content='Yes, Daniele Celsa is available on Monday at 10:00.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--1258b5d2-18e7-4f33-a0ea-36d89f320d04-0', usage_metadata={'input_tokens': 2853, 'output_tokens': 18, 'total_tokens': 2871, 'input_token_details': {'cache_read': 0}})]}
2025-11-06 07:56:10,964 - tool_logger - INFO - SQL_AGENT CALBACKS: {'gemini-2.0-flash': {'total_tokens': 10890, 'output_tokens': 231, 'input_token_details': {'cache_read': 0}, 'input_tokens': 10659}}
2025-11-06 07:56:11,676 - tool_logger - INFO - get_workflow called in PID=50020 TID=123145555496960 agent=0
2025-11-06 07:56:11,677 - tool_logger - INFO - Supervisor Tokens: Input= 1262, Output= 18, TOT= 1280
2025-11-06 07:56:11,678 - tool_logger - INFO - Supervisor Tokens: Input= 1303, Output= 16, TOT= 1319
2025-11-06 07:56:11,678 - tool_logger - INFO - Supervisor TOTAL Tokens: 2599
2025-11-06 07:56:11,678 - tool_logger - INFO - Writing 13 local_entries for Supervisor_agent_history (PID=50020 TID=123145555496960)
2025-11-06 07:56:11,679 - tool_logger - INFO - buffer_workflow called in PID=50020 TID=123145555496960 key=Supervisor_agent_history entries=13
2025-11-06 07:56:11,679 - tool_logger - INFO - Buffered Queue Workflow Supervisor_agent_history: ['_**Request**_:  \nIs Daniele Celsa available on Monday at 10?', '-> _**Supervisor Agent msg**_:  \n', '-> _**Call Tool**_:  \ncheck_staff_info', "-> _**With ARGS**_:  \n{'request': 'Is Daniele Celsa available on Monday at 10?'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 1262, Output= 18, TOT= 1280', '####---------------------------------------####', '-> _**Tool Name**_:  \ncheck_staff_info', '-> _**Tool msg**_:  \nYes, Daniele Celsa is available on Monday at 10:00.', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**Supervisor Agent msg**_:  \nDaniele Celsa is available on Monday at 10:00.', '-> _**TOKEN USAGE** (agent)_:  \nInput= 1303, Output= 16, TOT= 1319', '####---------------------------------------####']
2025-11-06 07:56:11,679 - tool_logger - INFO - buffer_usage called in PID=50020 TID=123145555496960 key=Supervisor_last_tokens total_token=2599
2025-11-06 07:56:11,679 - tool_logger - INFO - Buffered Queue Usage Supervisor_last_tokens: 2599
2025-11-06 07:56:11,679 - tool_logger - INFO - Flushing workflow from fallback queue: key=SQL_agent_history entries=31
2025-11-06 07:56:11,679 - tool_logger - ERROR - Error flushing workflow fallback queue: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "/Users/domenicodanielecelsa/Desktop/AI_Projects/mail-calendar-assistant/app.py", line 295, in flush_workflow_queue
    key, entries = WORKFLOW_QUEUE.get_nowait()
ValueError: too many values to unpack (expected 2)
2025-11-06 07:56:11,680 - tool_logger - INFO - Flushing usage from fallback queue: usage=('Supervisor_agent_history', ['_**Request**_:  \nIs Daniele Celsa available on Monday at 10?', '-> _**Supervisor Agent msg**_:  \n', '-> _**Call Tool**_:  \ncheck_staff_info', "-> _**With ARGS**_:  \n{'request': 'Is Daniele Celsa available on Monday at 10?'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 1262, Output= 18, TOT= 1280', '####---------------------------------------####', '-> _**Tool Name**_:  \ncheck_staff_info', '-> _**Tool msg**_:  \nYes, Daniele Celsa is available on Monday at 10:00.', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**Supervisor Agent msg**_:  \nDaniele Celsa is available on Monday at 10:00.', '-> _**TOKEN USAGE** (agent)_:  \nInput= 1303, Output= 16, TOT= 1319', '####---------------------------------------####'])
2025-11-06 07:56:11,680 - tool_logger - ERROR - Error flushing usage fallback queue: 'tuple' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/domenicodanielecelsa/Desktop/AI_Projects/mail-calendar-assistant/app.py", line 354, in flush_usage_queue
    key = usage.get("key")
AttributeError: 'tuple' object has no attribute 'get'
2025-11-06 07:56:11,737 - tool_logger - INFO - SUPERVISOR ANSWER: {'messages': [AIMessage(content='Hello, I am your personal assistant: I can schedule your Meetings and send Emails!  \nHow can I help you today?', additional_kwargs={}, response_metadata={}, id='ce3f7e9c-e6d7-4a9f-8b2e-901e04bb5540'), HumanMessage(content='Is Daniele Celsa available on Monday at 10?', additional_kwargs={}, response_metadata={}, id='e926c53a-1f7c-4e6a-8878-dbd430b71c88'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'check_staff_info', 'arguments': '{"request": "Is Daniele Celsa available on Monday at 10?"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--c36543ac-295b-47dd-b4af-cc4bef769aba-0', tool_calls=[{'name': 'check_staff_info', 'args': {'request': 'Is Daniele Celsa available on Monday at 10?'}, 'id': 'add4172c-c160-4af2-857f-36e5c1e12a05', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1262, 'output_tokens': 18, 'total_tokens': 1280, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='Yes, Daniele Celsa is available on Monday at 10:00.', name='check_staff_info', id='726b01c9-45fc-4010-8985-2ed97b736e69', tool_call_id='add4172c-c160-4af2-857f-36e5c1e12a05'), AIMessage(content='Daniele Celsa is available on Monday at 10:00.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': [], 'grounding_metadata': {}, 'model_provider': 'google_genai'}, id='lc_run--07aced59-9d1b-4192-af23-175efafd4a25-0', usage_metadata={'input_tokens': 1303, 'output_tokens': 16, 'total_tokens': 1319, 'input_token_details': {'cache_read': 0}})]}
2025-11-06 07:56:11,738 - tool_logger - INFO - SUPERVISOR CALBACKS: {'gemini-2.0-flash': {'total_tokens': 2599, 'output_tokens': 34, 'input_token_details': {'cache_read': 0}, 'input_tokens': 2565}}
2025-11-06 08:24:00,841 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
2025-11-06 09:06:04,106 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
2025-11-07 04:03:03,213 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
2025-11-07 04:04:28,777 - tool_logger - INFO - get_workflow called in PID=75647 TID=123145568374784 agent=1
2025-11-07 04:04:28,778 - tool_logger - INFO - SQL Tokens: Input= 2493, Output= 173, TOT= 2666
2025-11-07 04:04:28,779 - tool_logger - INFO - SQL Tokens: Input= 2517, Output= 9, TOT= 2526
2025-11-07 04:04:28,779 - tool_logger - INFO - SQL Tokens: Input= 2650, Output= 19, TOT= 2669
2025-11-07 04:04:28,779 - tool_logger - INFO - SQL Tokens: Input= 2692, Output= 21, TOT= 2713
2025-11-07 04:04:28,779 - tool_logger - INFO - SQL TOTAL Tokens: 10574
2025-11-07 04:04:28,780 - tool_logger - INFO - Writing 31 local_entries for SQL_agent_history (PID=75647 TID=123145568374784)
2025-11-07 04:04:28,780 - tool_logger - INFO - buffer_workflow called in PID=75647 TID=123145568374784 key=SQL_agent_history entries=31
2025-11-07 04:04:28,780 - tool_logger - INFO - Buffered Queue Workflow SQL_agent_history: ['_**Request**_:  \nWhat are the emails of the developer team members?', '-> _**SQL Agent msg**_:  \nOkay, I need to find the emails of the developer team members. Here\'s my plan:\n\n1.  **List tables:** I\'ll start by listing the available tables to understand the database structure.\n2.  **Schema of relevant table:** I\'ll then examine the schema of the `staff` table to identify the columns containing email addresses and team information.\n3.  **Construct the SQL query:** I\'ll build a query to select the email addresses from the `staff` table, filtering for members of the "developer" team.\n4.  **Execute the query:** I\'ll execute the query to retrieve the desired information.\n5.  **Present the results:** Finally, I\'ll present the list of email addresses.\n\nHere\'s the first step:', '-> _**Call Tool**_:  \nsql_db_list_tables', '-> _**With ARGS**_:  \n{}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2493, Output= 173, TOT= 2666', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_list_tables', '-> _**Tool msg**_:  \navailability, staff, staff_name_mapping', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \n', '-> _**Call Tool**_:  \nsql_db_schema', "-> _**With ARGS**_:  \n{'table_names': 'staff'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 2517, Output= 9, TOT= 2526', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_schema', '-> _**Tool msg**_:  \n\nCREATE TABLE staff (\n\tteam VARCHAR, \n\tname VARCHAR, \n\tsurname VARCHAR, \n\temail VARCHAR, \n\tfull_name_norm VARCHAR\n)\n\n/*\n3 rows from staff table:\nteam\tname\tsurname\temail\tfull_name_norm\nDesign\tMarco\tRossi\tmr@mail.com\tMarco_Rossi\nDesign\tLuca\tScanzi\tls@mail.com\tLuca_Scanzi\nDesign\tAnna\tGarau\tag@mail.com\tAnna_Garau\n*/', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \n', '-> _**Call Tool**_:  \nsql_db_query', '-> _**With ARGS**_:  \n{\'query\': "SELECT email FROM staff WHERE LOWER(team) = \'developer\'"}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2650, Output= 19, TOT= 2669', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_query', "-> _**Tool msg**_:  \n[('dc@mail.com',), ('rc@mail.com',)]", '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nThe emails of the developer team members are dc@mail.com and rc@mail.com.', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2692, Output= 21, TOT= 2713', '####---------------------------------------####']
2025-11-07 04:04:28,780 - tool_logger - INFO - buffer_usage called in PID=75647 TID=123145568374784 key=SQL_last_tokens total_token=10574
2025-11-07 04:04:28,780 - tool_logger - INFO - Buffered Queue Usage SQL_last_tokens: 10574
2025-11-07 04:04:28,780 - tool_logger - INFO - SQL_AGENT RESULT: {'messages': [HumanMessage(content='What are the emails of the developer team members?', additional_kwargs={}, response_metadata={}, id='be1a7a02-22fb-4306-aea2-956c75b787c8'), AIMessage(content='Okay, I need to find the emails of the developer team members. Here\'s my plan:\n\n1.  **List tables:** I\'ll start by listing the available tables to understand the database structure.\n2.  **Schema of relevant table:** I\'ll then examine the schema of the `staff` table to identify the columns containing email addresses and team information.\n3.  **Construct the SQL query:** I\'ll build a query to select the email addresses from the `staff` table, filtering for members of the "developer" team.\n4.  **Execute the query:** I\'ll execute the query to retrieve the desired information.\n5.  **Present the results:** Finally, I\'ll present the list of email addresses.\n\nHere\'s the first step:', additional_kwargs={'function_call': {'name': 'sql_db_list_tables', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--b2bfffa8-75fd-4e57-9c39-8f2c07b19fb2-0', tool_calls=[{'name': 'sql_db_list_tables', 'args': {}, 'id': '62e36830-b2f0-4a23-ba11-d0929fa14537', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2493, 'output_tokens': 173, 'total_tokens': 2666, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='availability, staff, staff_name_mapping', name='sql_db_list_tables', id='63f7dbdd-8fcb-4bad-9dee-804c8fb620b9', tool_call_id='62e36830-b2f0-4a23-ba11-d0929fa14537'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'sql_db_schema', 'arguments': '{"table_names": "staff"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--d1347ba8-0208-44bc-a072-7c2d190f9b12-0', tool_calls=[{'name': 'sql_db_schema', 'args': {'table_names': 'staff'}, 'id': 'b5e345e5-2e33-4ef6-bc16-37c292db6946', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2517, 'output_tokens': 9, 'total_tokens': 2526, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='\nCREATE TABLE staff (\n\tteam VARCHAR, \n\tname VARCHAR, \n\tsurname VARCHAR, \n\temail VARCHAR, \n\tfull_name_norm VARCHAR\n)\n\n/*\n3 rows from staff table:\nteam\tname\tsurname\temail\tfull_name_norm\nDesign\tMarco\tRossi\tmr@mail.com\tMarco_Rossi\nDesign\tLuca\tScanzi\tls@mail.com\tLuca_Scanzi\nDesign\tAnna\tGarau\tag@mail.com\tAnna_Garau\n*/', name='sql_db_schema', id='d0300391-1099-4909-bd06-77dd5fd3023f', tool_call_id='b5e345e5-2e33-4ef6-bc16-37c292db6946'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'sql_db_query', 'arguments': '{"query": "SELECT email FROM staff WHERE LOWER(team) = \'developer\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--32abe0ef-e3d3-449c-89d2-880c0efcf35f-0', tool_calls=[{'name': 'sql_db_query', 'args': {'query': "SELECT email FROM staff WHERE LOWER(team) = 'developer'"}, 'id': 'be62be36-4e5d-4145-a500-4b381e182967', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2650, 'output_tokens': 19, 'total_tokens': 2669, 'input_token_details': {'cache_read': 0}}), ToolMessage(content="[('dc@mail.com',), ('rc@mail.com',)]", name='sql_db_query', id='b5d987a2-c66e-48f9-a4c9-ae107a653cbe', tool_call_id='be62be36-4e5d-4145-a500-4b381e182967'), AIMessage(content='The emails of the developer team members are dc@mail.com and rc@mail.com.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--c2026977-dda0-4746-ae05-5fdca2a2b046-0', usage_metadata={'input_tokens': 2692, 'output_tokens': 21, 'total_tokens': 2713, 'input_token_details': {'cache_read': 0}})]}
2025-11-07 04:04:28,781 - tool_logger - INFO - SQL_AGENT CALBACKS: {'gemini-2.0-flash': {'input_tokens': 10352, 'output_tokens': 222, 'input_token_details': {'cache_read': 0}, 'total_tokens': 10574}}
2025-11-07 04:04:29,576 - tool_logger - INFO - send_email Sent email to: ['dc@mail.com', 'rc@mail.com'] with subject: Absence
2025-11-07 04:04:30,204 - tool_logger - INFO - get_workflow called in PID=75647 TID=123145518006272 agent=2
2025-11-07 04:04:30,204 - tool_logger - INFO - Mail Tokens: Input= 462, Output= 16, TOT= 478
2025-11-07 04:04:30,204 - tool_logger - INFO - Mail Tokens: Input= 661, Output= 30, TOT= 691
2025-11-07 04:04:30,204 - tool_logger - INFO - Mail Tokens: Input= 721, Output= 39, TOT= 760
2025-11-07 04:04:30,204 - tool_logger - INFO - Mail TOTAL Tokens: 1929
2025-11-07 04:04:30,204 - tool_logger - INFO - Writing 22 local_entries for Mail_agent_history (PID=75647 TID=123145518006272)
2025-11-07 04:04:30,204 - tool_logger - INFO - buffer_workflow called in PID=75647 TID=123145518006272 key=Mail_agent_history entries=22
2025-11-07 04:04:30,205 - tool_logger - INFO - Buffered Queue Workflow Mail_agent_history: ["_**Request**_:  \nSend an email to developer team saying I won't be at office today", '-> _**Mail Agent msg**_:  \n', '-> _**Call Tool**_:  \ncheck_staff_info', "-> _**With ARGS**_:  \n{'request': 'What are the emails of the developer team members?'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 462, Output= 16, TOT= 478', '####---------------------------------------####', '-> _**Tool Name**_:  \ncheck_staff_info', "-> _**Tool msg**_:  \n<bound method BaseMessage.text of AIMessage(content='The emails of the developer team members are dc@mail.com and rc@mail.com.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--c2026977-dda0-4746-ae05-5fdca2a2b046-0', usage_metadata={'input_tokens': 2692, 'output_tokens': 21, 'total_tokens': 2713, 'input_token_details': {'cache_read': 0}})>", '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**Mail Agent msg**_:  \n', '-> _**Call Tool**_:  \nsend_email', '-> _**With ARGS**_:  \n{\'subject\': \'Absence\', \'body\': "I won\'t be at the office today. \\n\\nDani", \'to\': [\'dc@mail.com\', \'rc@mail.com\']}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 661, Output= 30, TOT= 691', '####---------------------------------------####', '-> _**Tool Name**_:  \nsend_email', '-> _**Tool msg**_:  \nEmail sent to dc@mail.com, rc@mail.com - Subject: Absence - Body length: 38 characters', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', "-> _**Mail Agent msg**_:  \nEmail sent to developer team (dc@mail.com, rc@mail.com) with subject 'Absence' and body 'I won't be at the office today. Dani'", '-> _**TOKEN USAGE** (agent)_:  \nInput= 721, Output= 39, TOT= 760', '####---------------------------------------####']
2025-11-07 04:04:30,205 - tool_logger - INFO - buffer_usage called in PID=75647 TID=123145518006272 key=Mail_last_tokens total_token=1929
2025-11-07 04:04:30,205 - tool_logger - INFO - Buffered Queue Usage Mail_last_tokens: 1929
2025-11-07 04:04:30,205 - tool_logger - INFO - MAIL_AGENT RESULT: {'messages': [HumanMessage(content="Send an email to developer team saying I won't be at office today", additional_kwargs={}, response_metadata={}, id='1d7c47c7-e216-4e07-bb82-066efb52d04d'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'check_staff_info', 'arguments': '{"request": "What are the emails of the developer team members?"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--38767f5d-3044-49f3-be91-51b2dbbde4e6-0', tool_calls=[{'name': 'check_staff_info', 'args': {'request': 'What are the emails of the developer team members?'}, 'id': 'b575225e-425a-47c4-bc7e-c3087ff58670', 'type': 'tool_call'}], usage_metadata={'input_tokens': 462, 'output_tokens': 16, 'total_tokens': 478, 'input_token_details': {'cache_read': 0}}), ToolMessage(content="<bound method BaseMessage.text of AIMessage(content='The emails of the developer team members are dc@mail.com and rc@mail.com.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--c2026977-dda0-4746-ae05-5fdca2a2b046-0', usage_metadata={'input_tokens': 2692, 'output_tokens': 21, 'total_tokens': 2713, 'input_token_details': {'cache_read': 0}})>", name='check_staff_info', id='01cdb4ff-a54a-4732-b9a1-a5360d9b11a9', tool_call_id='b575225e-425a-47c4-bc7e-c3087ff58670'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'send_email', 'arguments': '{"subject": "Absence", "body": "I won\'t be at the office today. \\n\\nDani", "to": ["dc@mail.com", "rc@mail.com"]}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--3c993927-df41-48af-bd36-4d10a14b54ed-0', tool_calls=[{'name': 'send_email', 'args': {'subject': 'Absence', 'body': "I won't be at the office today. \n\nDani", 'to': ['dc@mail.com', 'rc@mail.com']}, 'id': 'ec4364f8-0e59-40e8-97f4-be2ef5a48bb0', 'type': 'tool_call'}], usage_metadata={'input_tokens': 661, 'output_tokens': 30, 'total_tokens': 691, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='Email sent to dc@mail.com, rc@mail.com - Subject: Absence - Body length: 38 characters', name='send_email', id='39381412-add8-4b07-8bd6-2c4414079a73', tool_call_id='ec4364f8-0e59-40e8-97f4-be2ef5a48bb0'), AIMessage(content="Email sent to developer team (dc@mail.com, rc@mail.com) with subject 'Absence' and body 'I won't be at the office today. Dani'", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--9447d759-b045-43ba-ac0a-1ee9793a2a12-0', usage_metadata={'input_tokens': 721, 'output_tokens': 39, 'total_tokens': 760, 'input_token_details': {'cache_read': 0}})]}
2025-11-07 04:04:30,206 - tool_logger - INFO - MAIL_AGENT CALBACKS: {'gemini-2.0-flash': {'input_tokens': 1844, 'output_tokens': 85, 'input_token_details': {'cache_read': 0}, 'total_tokens': 1929}}
2025-11-07 04:04:32,045 - tool_logger - INFO - get_workflow called in PID=75647 TID=123145448165376 agent=0
2025-11-07 04:04:32,048 - tool_logger - INFO - Supervisor Tokens: Input= 1265, Output= 19, TOT= 1284
2025-11-07 04:04:32,049 - tool_logger - INFO - Supervisor Tokens: Input= 1483, Output= 47, TOT= 1530
2025-11-07 04:04:32,049 - tool_logger - INFO - Supervisor TOTAL Tokens: 2814
2025-11-07 04:04:32,049 - tool_logger - INFO - Writing 13 local_entries for Supervisor_agent_history (PID=75647 TID=123145448165376)
2025-11-07 04:04:32,049 - tool_logger - INFO - buffer_workflow called in PID=75647 TID=123145448165376 key=Supervisor_agent_history entries=13
2025-11-07 04:04:32,050 - tool_logger - INFO - Buffered Queue Workflow Supervisor_agent_history: ["_**Request**_:  \nSend an email to developer team saying I won't be at office today", '-> _**Supervisor Agent msg**_:  \n', '-> _**Call Tool**_:  \nmanage_mail', '-> _**With ARGS**_:  \n{\'request\': "Send an email to developer team saying I won\'t be at office today"}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 1265, Output= 19, TOT= 1284', '####---------------------------------------####', '-> _**Tool Name**_:  \nmanage_mail', '-> _**Tool msg**_:  \n<bound method BaseMessage.text of AIMessage(content="Email sent to developer team (dc@mail.com, rc@mail.com) with subject \'Absence\' and body \'I won\'t be at the office today. Dani\'", additional_kwargs={}, response_metadata={\'prompt_feedback\': {\'block_reason\': 0, \'safety_ratings\': []}, \'finish_reason\': \'STOP\', \'model_name\': \'gemini-2.0-flash\', \'safety_ratings\': []}, id=\'run--9447d759-b045-43ba-ac0a-1ee9793a2a12-0\', usage_metadata={\'input_tokens\': 721, \'output_tokens\': 39, \'total_tokens\': 760, \'input_token_details\': {\'cache_read\': 0}})>', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', "-> _**Supervisor Agent msg**_:  \nOK. I've sent an email to the developer team (dc@mail.com, rc@mail.com) with the subject 'Absence' and body 'I won't be at the office today. Dani'.", '-> _**TOKEN USAGE** (agent)_:  \nInput= 1483, Output= 47, TOT= 1530', '####---------------------------------------####']
2025-11-07 04:04:32,053 - tool_logger - INFO - buffer_usage called in PID=75647 TID=123145448165376 key=Supervisor_last_tokens total_token=2814
2025-11-07 04:04:32,054 - tool_logger - INFO - Buffered Queue Usage Supervisor_last_tokens: 2814
2025-11-07 04:04:32,061 - tool_logger - INFO - Flushing workflow from fallback queue: key=SQL_agent_history entries=31
2025-11-07 04:04:32,062 - tool_logger - ERROR - Error flushing workflow fallback queue: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "/Users/domenicodanielecelsa/Desktop/AI_Projects/mail-calendar-assistant/app.py", line 295, in flush_workflow_queue
    key, entries = WORKFLOW_QUEUE.get_nowait()
ValueError: too many values to unpack (expected 2)
2025-11-07 04:04:32,064 - tool_logger - INFO - Flushing usage from fallback queue: usage=('Mail_agent_history', ["_**Request**_:  \nSend an email to developer team saying I won't be at office today", '-> _**Mail Agent msg**_:  \n', '-> _**Call Tool**_:  \ncheck_staff_info', "-> _**With ARGS**_:  \n{'request': 'What are the emails of the developer team members?'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 462, Output= 16, TOT= 478', '####---------------------------------------####', '-> _**Tool Name**_:  \ncheck_staff_info', "-> _**Tool msg**_:  \n<bound method BaseMessage.text of AIMessage(content='The emails of the developer team members are dc@mail.com and rc@mail.com.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--c2026977-dda0-4746-ae05-5fdca2a2b046-0', usage_metadata={'input_tokens': 2692, 'output_tokens': 21, 'total_tokens': 2713, 'input_token_details': {'cache_read': 0}})>", '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**Mail Agent msg**_:  \n', '-> _**Call Tool**_:  \nsend_email', '-> _**With ARGS**_:  \n{\'subject\': \'Absence\', \'body\': "I won\'t be at the office today. \\n\\nDani", \'to\': [\'dc@mail.com\', \'rc@mail.com\']}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 661, Output= 30, TOT= 691', '####---------------------------------------####', '-> _**Tool Name**_:  \nsend_email', '-> _**Tool msg**_:  \nEmail sent to dc@mail.com, rc@mail.com - Subject: Absence - Body length: 38 characters', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', "-> _**Mail Agent msg**_:  \nEmail sent to developer team (dc@mail.com, rc@mail.com) with subject 'Absence' and body 'I won't be at the office today. Dani'", '-> _**TOKEN USAGE** (agent)_:  \nInput= 721, Output= 39, TOT= 760', '####---------------------------------------####'])
2025-11-07 04:04:32,064 - tool_logger - ERROR - Error flushing usage fallback queue: 'tuple' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/domenicodanielecelsa/Desktop/AI_Projects/mail-calendar-assistant/app.py", line 354, in flush_usage_queue
    key = usage.get("key")
AttributeError: 'tuple' object has no attribute 'get'
2025-11-07 04:04:32,124 - tool_logger - INFO - SUPERVISOR ANSWER: {'messages': [AIMessage(content='Hello, I am your personal assistant: I can schedule your Meetings and send Emails!  \nHow can I help you today?', additional_kwargs={}, response_metadata={}, id='7b65a948-f36d-4b92-b675-e75ecc135aa6'), HumanMessage(content="Send an email to developer team saying I won't be at office today", additional_kwargs={}, response_metadata={}, id='a963181b-7a45-4446-a695-982cc25502ef'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'manage_mail', 'arguments': '{"request": "Send an email to developer team saying I won\'t be at office today"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--0a7be3f1-5c79-47b1-b5b8-abdfe1ebc43e-0', tool_calls=[{'name': 'manage_mail', 'args': {'request': "Send an email to developer team saying I won't be at office today"}, 'id': '949277f8-e4fb-442d-a42b-2ef36a908a1f', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1265, 'output_tokens': 19, 'total_tokens': 1284, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='<bound method BaseMessage.text of AIMessage(content="Email sent to developer team (dc@mail.com, rc@mail.com) with subject \'Absence\' and body \'I won\'t be at the office today. Dani\'", additional_kwargs={}, response_metadata={\'prompt_feedback\': {\'block_reason\': 0, \'safety_ratings\': []}, \'finish_reason\': \'STOP\', \'model_name\': \'gemini-2.0-flash\', \'safety_ratings\': []}, id=\'run--9447d759-b045-43ba-ac0a-1ee9793a2a12-0\', usage_metadata={\'input_tokens\': 721, \'output_tokens\': 39, \'total_tokens\': 760, \'input_token_details\': {\'cache_read\': 0}})>', name='manage_mail', id='42a78419-4c44-49fa-a9ca-8ee425bc1057', tool_call_id='949277f8-e4fb-442d-a42b-2ef36a908a1f'), AIMessage(content="OK. I've sent an email to the developer team (dc@mail.com, rc@mail.com) with the subject 'Absence' and body 'I won't be at the office today. Dani'.", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--20bba748-8404-406a-abc1-f3a5953a1389-0', usage_metadata={'input_tokens': 1483, 'output_tokens': 47, 'total_tokens': 1530, 'input_token_details': {'cache_read': 0}})]}
2025-11-07 04:04:32,125 - tool_logger - INFO - SUPERVISOR CALBACKS: {'gemini-2.0-flash': {'input_tokens': 2748, 'output_tokens': 66, 'input_token_details': {'cache_read': 0}, 'total_tokens': 2814}}
2025-11-07 04:49:28,993 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
2025-11-07 04:49:51,386 - tool_logger - INFO - get_workflow called in PID=77169 TID=123145550184448 agent=1
2025-11-07 04:49:51,386 - tool_logger - INFO - SQL Tokens: Input= 2499, Output= 181, TOT= 2680
2025-11-07 04:49:51,386 - tool_logger - INFO - SQL Tokens: Input= 2523, Output= 9, TOT= 2532
2025-11-07 04:49:51,386 - tool_logger - INFO - SQL Tokens: Input= 2656, Output= 23, TOT= 2679
2025-11-07 04:49:51,387 - tool_logger - INFO - SQL Tokens: Input= 2715, Output= 33, TOT= 2748
2025-11-07 04:49:51,387 - tool_logger - INFO - SQL TOTAL Tokens: 10639
2025-11-07 04:49:51,387 - tool_logger - INFO - Writing 31 local_entries for SQL_agent_history (PID=77169 TID=123145550184448)
2025-11-07 04:49:51,387 - tool_logger - INFO - buffer_workflow called in PID=77169 TID=123145550184448 key=SQL_agent_history entries=31
2025-11-07 04:49:51,387 - tool_logger - INFO - Buffered Queue Workflow SQL_agent_history: ['_**Request**_:  \nWho are the members of the DEVELOPER team? Provide names and emails.', "-> _**SQL Agent msg**_:  \nOkay, I need to find the members of the DEVELOPER team and list their names and emails. Here's my plan:\n\n1.  **List tables:** Use `sql_db_list_tables` to see what tables are available.\n2.  **Examine schema:** Use `sql_db_schema` to inspect the `staff` table for relevant columns like `name`, `email`, and `team`.\n3.  **Construct query:** Build a `SELECT` query to retrieve the names and emails of staff members where the team is DEVELOPER.\n4.  **Execute query:** Use `sql_db_query` to run the query and get the results.\n5.  **Present results:** Format the results into a readable list of names and emails.\n\nHere's the first step:", '-> _**Call Tool**_:  \nsql_db_list_tables', '-> _**With ARGS**_:  \n{}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2499, Output= 181, TOT= 2680', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_list_tables', '-> _**Tool msg**_:  \navailability, staff, staff_name_mapping', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \n', '-> _**Call Tool**_:  \nsql_db_schema', "-> _**With ARGS**_:  \n{'table_names': 'staff'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 2523, Output= 9, TOT= 2532', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_schema', '-> _**Tool msg**_:  \n\nCREATE TABLE staff (\n\tteam VARCHAR, \n\tname VARCHAR, \n\tsurname VARCHAR, \n\temail VARCHAR, \n\tfull_name_norm VARCHAR\n)\n\n/*\n3 rows from staff table:\nteam\tname\tsurname\temail\tfull_name_norm\nDesign\tMarco\tRossi\tmr@mail.com\tMarco_Rossi\nDesign\tLuca\tScanzi\tls@mail.com\tLuca_Scanzi\nDesign\tAnna\tGarau\tag@mail.com\tAnna_Garau\n*/', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \n', '-> _**Call Tool**_:  \nsql_db_query', '-> _**With ARGS**_:  \n{\'query\': "SELECT name, surname, email FROM staff WHERE LOWER(team) = \'developer\'"}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2656, Output= 23, TOT= 2679', '####---------------------------------------####', '-> _**Tool Name**_:  \nsql_db_query', "-> _**Tool msg**_:  \n[('Daniele', 'Celsa', 'dc@mail.com'), ('Roberto', 'Coppolino', 'rc@mail.com')]", '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**SQL Agent msg**_:  \nThe members of the DEVELOPER team are: Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com).', '-> _**TOKEN USAGE** (agent)_:  \nInput= 2715, Output= 33, TOT= 2748', '####---------------------------------------####']
2025-11-07 04:49:51,388 - tool_logger - INFO - buffer_usage called in PID=77169 TID=123145550184448 key=SQL_last_tokens total_token=10639
2025-11-07 04:49:51,388 - tool_logger - INFO - Buffered Queue Usage SQL_last_tokens: 10639
2025-11-07 04:49:51,388 - tool_logger - INFO - SQL_AGENT RESULT: {'messages': [HumanMessage(content='Who are the members of the DEVELOPER team? Provide names and emails.', additional_kwargs={}, response_metadata={}, id='8a28f001-27bd-4ed1-b750-0e1b9c040dc1'), AIMessage(content="Okay, I need to find the members of the DEVELOPER team and list their names and emails. Here's my plan:\n\n1.  **List tables:** Use `sql_db_list_tables` to see what tables are available.\n2.  **Examine schema:** Use `sql_db_schema` to inspect the `staff` table for relevant columns like `name`, `email`, and `team`.\n3.  **Construct query:** Build a `SELECT` query to retrieve the names and emails of staff members where the team is DEVELOPER.\n4.  **Execute query:** Use `sql_db_query` to run the query and get the results.\n5.  **Present results:** Format the results into a readable list of names and emails.\n\nHere's the first step:", additional_kwargs={'function_call': {'name': 'sql_db_list_tables', 'arguments': '{}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7cc01d70-aa86-49a0-9294-8116f7f58e08-0', tool_calls=[{'name': 'sql_db_list_tables', 'args': {}, 'id': 'eceb5fb8-f822-4541-bf1b-695cb0de0dc2', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2499, 'output_tokens': 181, 'total_tokens': 2680, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='availability, staff, staff_name_mapping', name='sql_db_list_tables', id='b157c890-02ef-4b2d-ba80-a299674eb836', tool_call_id='eceb5fb8-f822-4541-bf1b-695cb0de0dc2'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'sql_db_schema', 'arguments': '{"table_names": "staff"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--0b852846-632e-439c-95fd-b845591ac3ff-0', tool_calls=[{'name': 'sql_db_schema', 'args': {'table_names': 'staff'}, 'id': '756a9483-fa51-406b-b9d9-e82a850c7c14', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2523, 'output_tokens': 9, 'total_tokens': 2532, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='\nCREATE TABLE staff (\n\tteam VARCHAR, \n\tname VARCHAR, \n\tsurname VARCHAR, \n\temail VARCHAR, \n\tfull_name_norm VARCHAR\n)\n\n/*\n3 rows from staff table:\nteam\tname\tsurname\temail\tfull_name_norm\nDesign\tMarco\tRossi\tmr@mail.com\tMarco_Rossi\nDesign\tLuca\tScanzi\tls@mail.com\tLuca_Scanzi\nDesign\tAnna\tGarau\tag@mail.com\tAnna_Garau\n*/', name='sql_db_schema', id='dfe05e63-e16e-43c0-afc9-d99404717378', tool_call_id='756a9483-fa51-406b-b9d9-e82a850c7c14'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'sql_db_query', 'arguments': '{"query": "SELECT name, surname, email FROM staff WHERE LOWER(team) = \'developer\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7ef49259-1caf-4aee-9818-aebf1b6eb572-0', tool_calls=[{'name': 'sql_db_query', 'args': {'query': "SELECT name, surname, email FROM staff WHERE LOWER(team) = 'developer'"}, 'id': '200b44e3-e466-445d-97c1-4b47cb16a107', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2656, 'output_tokens': 23, 'total_tokens': 2679, 'input_token_details': {'cache_read': 0}}), ToolMessage(content="[('Daniele', 'Celsa', 'dc@mail.com'), ('Roberto', 'Coppolino', 'rc@mail.com')]", name='sql_db_query', id='b2919d36-82f8-4913-b65a-725839294d75', tool_call_id='200b44e3-e466-445d-97c1-4b47cb16a107'), AIMessage(content='The members of the DEVELOPER team are: Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com).', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--3289f01f-1701-4441-93bf-bb5e89e59d05-0', usage_metadata={'input_tokens': 2715, 'output_tokens': 33, 'total_tokens': 2748, 'input_token_details': {'cache_read': 0}})]}
2025-11-07 04:49:51,389 - tool_logger - INFO - SQL_AGENT CALBACKS: {'gemini-2.0-flash': {'output_tokens': 246, 'input_token_details': {'cache_read': 0}, 'input_tokens': 10393, 'total_tokens': 10639}}
2025-11-07 04:49:52,307 - tool_logger - INFO - send_email Sent email to: ['dc@mail.com', 'rc@mail.com'] with subject: Absence
2025-11-07 04:49:53,126 - tool_logger - INFO - get_workflow called in PID=77169 TID=123145533394944 agent=2
2025-11-07 04:49:53,127 - tool_logger - INFO - Mail Tokens: Input= 462, Output= 22, TOT= 484
2025-11-07 04:49:53,127 - tool_logger - INFO - Mail Tokens: Input= 683, Output= 36, TOT= 719
2025-11-07 04:49:53,127 - tool_logger - INFO - Mail Tokens: Input= 749, Output= 58, TOT= 807
2025-11-07 04:49:53,128 - tool_logger - INFO - Mail TOTAL Tokens: 2010
2025-11-07 04:49:53,128 - tool_logger - INFO - Writing 22 local_entries for Mail_agent_history (PID=77169 TID=123145533394944)
2025-11-07 04:49:53,128 - tool_logger - INFO - buffer_workflow called in PID=77169 TID=123145533394944 key=Mail_agent_history entries=22
2025-11-07 04:49:53,128 - tool_logger - INFO - Buffered Queue Workflow Mail_agent_history: ["_**Request**_:  \nSend an email to developer team saying I won't be at office today", '-> _**Mail Agent msg**_:  \n', '-> _**Call Tool**_:  \ncheck_staff_info', "-> _**With ARGS**_:  \n{'request': 'Who are the members of the DEVELOPER team? Provide names and emails.'}", '-> _**TOKEN USAGE** (agent)_:  \nInput= 462, Output= 22, TOT= 484', '####---------------------------------------####', '-> _**Tool Name**_:  \ncheck_staff_info', "-> _**Tool msg**_:  \n<bound method BaseMessage.text of AIMessage(content='The members of the DEVELOPER team are: Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com).', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--3289f01f-1701-4441-93bf-bb5e89e59d05-0', usage_metadata={'input_tokens': 2715, 'output_tokens': 33, 'total_tokens': 2748, 'input_token_details': {'cache_read': 0}})>", '-> _**Status**_:  \nsuccess', '####---------------------------------------####', '-> _**Mail Agent msg**_:  \n', '-> _**Call Tool**_:  \nsend_email', '-> _**With ARGS**_:  \n{\'to\': [\'dc@mail.com\', \'rc@mail.com\'], \'subject\': \'Absence\', \'body\': "Hi Team,\\n\\nI won\'t be at the office today.\\n\\nBest,\\nDani"}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 683, Output= 36, TOT= 719', '####---------------------------------------####', '-> _**Tool Name**_:  \nsend_email', '-> _**Tool msg**_:  \nEmail sent to dc@mail.com, rc@mail.com - Subject: Absence - Body length: 53 characters', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', "-> _**Mail Agent msg**_:  \nEmail sent to Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com) with subject 'Absence' and body 'Hi Team,\\n\\nI won't be at the office today.\\n\\nBest,\\nDani'.", '-> _**TOKEN USAGE** (agent)_:  \nInput= 749, Output= 58, TOT= 807', '####---------------------------------------####']
2025-11-07 04:49:53,128 - tool_logger - INFO - buffer_usage called in PID=77169 TID=123145533394944 key=Mail_last_tokens total_token=2010
2025-11-07 04:49:53,128 - tool_logger - INFO - Buffered Queue Usage Mail_last_tokens: 2010
2025-11-07 04:49:53,129 - tool_logger - INFO - MAIL_AGENT RESULT: {'messages': [HumanMessage(content="Send an email to developer team saying I won't be at office today", additional_kwargs={}, response_metadata={}, id='0daeebae-a129-468d-b9a0-e4f0d33bffc6'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'check_staff_info', 'arguments': '{"request": "Who are the members of the DEVELOPER team? Provide names and emails."}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8931cb22-107e-493c-8cff-cbe40fd82bd9-0', tool_calls=[{'name': 'check_staff_info', 'args': {'request': 'Who are the members of the DEVELOPER team? Provide names and emails.'}, 'id': '1f8dd4e6-7e75-4d73-b177-d1fb09fb8bb3', 'type': 'tool_call'}], usage_metadata={'input_tokens': 462, 'output_tokens': 22, 'total_tokens': 484, 'input_token_details': {'cache_read': 0}}), ToolMessage(content="<bound method BaseMessage.text of AIMessage(content='The members of the DEVELOPER team are: Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com).', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--3289f01f-1701-4441-93bf-bb5e89e59d05-0', usage_metadata={'input_tokens': 2715, 'output_tokens': 33, 'total_tokens': 2748, 'input_token_details': {'cache_read': 0}})>", name='check_staff_info', id='875f9c8f-5ecc-4e45-9dd7-3da91b266d13', tool_call_id='1f8dd4e6-7e75-4d73-b177-d1fb09fb8bb3'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'send_email', 'arguments': '{"to": ["dc@mail.com", "rc@mail.com"], "subject": "Absence", "body": "Hi Team,\\n\\nI won\'t be at the office today.\\n\\nBest,\\nDani"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f2d768da-e363-41fb-a211-a47188ae4563-0', tool_calls=[{'name': 'send_email', 'args': {'to': ['dc@mail.com', 'rc@mail.com'], 'subject': 'Absence', 'body': "Hi Team,\n\nI won't be at the office today.\n\nBest,\nDani"}, 'id': '8d38cad5-91a6-4674-9a52-9ed21176c52a', 'type': 'tool_call'}], usage_metadata={'input_tokens': 683, 'output_tokens': 36, 'total_tokens': 719, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='Email sent to dc@mail.com, rc@mail.com - Subject: Absence - Body length: 53 characters', name='send_email', id='f8b5d055-58cd-4fb6-ae45-8d2530db3013', tool_call_id='8d38cad5-91a6-4674-9a52-9ed21176c52a'), AIMessage(content="Email sent to Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com) with subject 'Absence' and body 'Hi Team,\\n\\nI won't be at the office today.\\n\\nBest,\\nDani'.", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8f192e65-da95-403a-8947-c7261191438c-0', usage_metadata={'input_tokens': 749, 'output_tokens': 58, 'total_tokens': 807, 'input_token_details': {'cache_read': 0}})]}
2025-11-07 04:49:53,129 - tool_logger - INFO - MAIL_AGENT CALBACKS: {'gemini-2.0-flash': {'output_tokens': 116, 'input_token_details': {'cache_read': 0}, 'input_tokens': 1894, 'total_tokens': 2010}}
2025-11-07 04:49:55,174 - tool_logger - INFO - get_workflow called in PID=77169 TID=123145463554048 agent=0
2025-11-07 04:49:55,174 - tool_logger - INFO - Supervisor Tokens: Input= 1265, Output= 19, TOT= 1284
2025-11-07 04:49:55,175 - tool_logger - INFO - Supervisor Tokens: Input= 1505, Output= 63, TOT= 1568
2025-11-07 04:49:55,175 - tool_logger - INFO - Supervisor TOTAL Tokens: 2852
2025-11-07 04:49:55,175 - tool_logger - INFO - Writing 13 local_entries for Supervisor_agent_history (PID=77169 TID=123145463554048)
2025-11-07 04:49:55,175 - tool_logger - INFO - buffer_workflow called in PID=77169 TID=123145463554048 key=Supervisor_agent_history entries=13
2025-11-07 04:49:55,175 - tool_logger - INFO - Buffered Queue Workflow Supervisor_agent_history: ["_**Request**_:  \nSend an email to developer team saying I won't be at office today", '-> _**Supervisor Agent msg**_:  \n', '-> _**Call Tool**_:  \nmanage_mail', '-> _**With ARGS**_:  \n{\'request\': "Send an email to developer team saying I won\'t be at office today"}', '-> _**TOKEN USAGE** (agent)_:  \nInput= 1265, Output= 19, TOT= 1284', '####---------------------------------------####', '-> _**Tool Name**_:  \nmanage_mail', '-> _**Tool msg**_:  \n<bound method BaseMessage.text of AIMessage(content="Email sent to Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com) with subject \'Absence\' and body \'Hi Team,\\\\n\\\\nI won\'t be at the office today.\\\\n\\\\nBest,\\\\nDani\'.", additional_kwargs={}, response_metadata={\'prompt_feedback\': {\'block_reason\': 0, \'safety_ratings\': []}, \'finish_reason\': \'STOP\', \'model_name\': \'gemini-2.0-flash\', \'safety_ratings\': []}, id=\'run--8f192e65-da95-403a-8947-c7261191438c-0\', usage_metadata={\'input_tokens\': 749, \'output_tokens\': 58, \'total_tokens\': 807, \'input_token_details\': {\'cache_read\': 0}})>', '-> _**Status**_:  \nsuccess', '####---------------------------------------####', "-> _**Supervisor Agent msg**_:  \nOK. I've sent an email to Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com) with the subject 'Absence' and body:\n\n'Hi Team,\n\nI won't be at the office today.\n\nBest,\nDani'", '-> _**TOKEN USAGE** (agent)_:  \nInput= 1505, Output= 63, TOT= 1568', '####---------------------------------------####']
2025-11-07 04:49:55,175 - tool_logger - INFO - buffer_usage called in PID=77169 TID=123145463554048 key=Supervisor_last_tokens total_token=2852
2025-11-07 04:49:55,175 - tool_logger - INFO - Buffered Queue Usage Supervisor_last_tokens: 2852
2025-11-07 04:49:55,175 - tool_logger - INFO - Flushing workflow from fallback queue: key=SQL_agent_history entries=31
2025-11-07 04:49:55,176 - tool_logger - INFO - Flushing workflow from fallback queue: key=Mail_agent_history entries=22
2025-11-07 04:49:55,176 - tool_logger - INFO - Flushing workflow from fallback queue: key=Supervisor_agent_history entries=13
2025-11-07 04:49:55,176 - tool_logger - INFO - Flushing usage from fallback queue: usage={'key': 'SQL_last_tokens', 'input_tokens': 10393, 'output_tokens': 246, 'total_tokens': 10639}
2025-11-07 04:49:55,177 - tool_logger - INFO - Flushing usage from fallback queue: usage={'key': 'Mail_last_tokens', 'input_tokens': 1894, 'output_tokens': 116, 'total_tokens': 2010}
2025-11-07 04:49:55,177 - tool_logger - INFO - Flushing usage from fallback queue: usage={'key': 'Supervisor_last_tokens', 'input_tokens': 2770, 'output_tokens': 82, 'total_tokens': 2852}
2025-11-07 04:49:55,237 - tool_logger - INFO - SUPERVISOR ANSWER: {'messages': [AIMessage(content='Hello, I am your personal assistant: I can schedule your Meetings and send Emails!  \nHow can I help you today?', additional_kwargs={}, response_metadata={}, id='c5d9ee32-7dc4-4eeb-9084-852b6088f440'), HumanMessage(content="Send an email to developer team saying I won't be at office today", additional_kwargs={}, response_metadata={}, id='8e8bd94d-4465-4c6f-9c81-d41b8e082d2a'), AIMessage(content='', additional_kwargs={'function_call': {'name': 'manage_mail', 'arguments': '{"request": "Send an email to developer team saying I won\'t be at office today"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--e08654d3-04c9-44b9-9dc8-0ca88d7caa45-0', tool_calls=[{'name': 'manage_mail', 'args': {'request': "Send an email to developer team saying I won't be at office today"}, 'id': '91f542c6-002d-425d-9fef-76f57a47c37a', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1265, 'output_tokens': 19, 'total_tokens': 1284, 'input_token_details': {'cache_read': 0}}), ToolMessage(content='<bound method BaseMessage.text of AIMessage(content="Email sent to Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com) with subject \'Absence\' and body \'Hi Team,\\\\n\\\\nI won\'t be at the office today.\\\\n\\\\nBest,\\\\nDani\'.", additional_kwargs={}, response_metadata={\'prompt_feedback\': {\'block_reason\': 0, \'safety_ratings\': []}, \'finish_reason\': \'STOP\', \'model_name\': \'gemini-2.0-flash\', \'safety_ratings\': []}, id=\'run--8f192e65-da95-403a-8947-c7261191438c-0\', usage_metadata={\'input_tokens\': 749, \'output_tokens\': 58, \'total_tokens\': 807, \'input_token_details\': {\'cache_read\': 0}})>', name='manage_mail', id='c58f3264-1dd3-4eee-9bf8-3c610d554ea2', tool_call_id='91f542c6-002d-425d-9fef-76f57a47c37a'), AIMessage(content="OK. I've sent an email to Daniele Celsa (dc@mail.com) and Roberto Coppolino (rc@mail.com) with the subject 'Absence' and body:\n\n'Hi Team,\n\nI won't be at the office today.\n\nBest,\nDani'", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--85bc401a-4cc0-4bad-8d23-2291a7bf4d02-0', usage_metadata={'input_tokens': 1505, 'output_tokens': 63, 'total_tokens': 1568, 'input_token_details': {'cache_read': 0}})]}
2025-11-07 04:49:55,238 - tool_logger - INFO - SUPERVISOR CALBACKS: {'gemini-2.0-flash': {'output_tokens': 82, 'input_token_details': {'cache_read': 0}, 'input_tokens': 2770, 'total_tokens': 2852}}
2025-11-07 04:51:30,081 - tool_logger - WARNING - Could not connect to Redis: Error 61 connecting to localhost:6379. Connection refused.. Using in-memory queue as fallback.
